<template>
  <div class="connexion">
    <div class="content">
      <h1>Connexion</h1>
      <form>
        <label for="signup-email" class="sr-only">Email</label>
        <input type="email" id="signup-email" placeholder="Email" v-model="credentials.username" required>

        <label for="signup-password" class="sr-only">Mot de passe</label>
        <input type="password" id="signup-password" name="signup-password" placeholder="Votre mot de passe" v-model="credentials.password">

        <button @click.prevent="login" type="submit">Se connecter</button>

        <p class="login-link">Vous n'avez pas de compte ?</p>
        <p>
          <NuxtLink to="/inscription">Inscrivez-vous</NuxtLink>
        </p>

      </form>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const credentials = ref({
  username: '',
  password: ''
});

const login = async () => {
  const response = await fetch('https://localhost:8000/api/users/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(credentials.value)
  });

  if (!response.ok) {
    const errorData = await response.json();
    alert(`Login failed: ${errorData.message}`);
    return;
  }

  const data = await response.json();
  console.log(data.token);
  let user = data.token.split('.')[1];
  user = JSON.parse(atob(user))
  console.log(user);
  // On stocke le token dans le localStorage
  localStorage.setItem('token', data.token);
  
  //alert(`Login successful: ${user}`);
  // Ici, g√©rer la logique de session ou de stockage du token
};
</script>

<style scoped lang="scss">
@import 'assets/base/colors';

h2 {
    text-align: center;
    margin-bottom: 20px;
}

.connexion {
    position: relative;
    padding: 20px;
    margin-top: 50px;
    overflow: hidden;
    background-color: $beigeclair;
    box-shadow: 0 0 30px 0 rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 24px;
    margin: 50px 14px;
    overflow: hidden;
    max-width: 450px;
    margin: 30px auto;
}

.content {
    position: relative;
    z-index: 1;

    label,
    input,
    button {
        width: 100%;
        height: 2.5rem;
        display: block;
        margin-bottom: 20px;
        padding: 5px;
    }

    button {
        background-color: $mandarin;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    p {
        text-align: center;
    }
}
</style>